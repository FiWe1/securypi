{% extends 'base.html' %}
{% block body %}
<div class="recordings">
  <h1 class="recordings__title">{% block title %}Recordings{% endblock %}</h1>
  
  <form class="recordings__form" method="post">
    <div class="recordings__list">
      <div class="recordings__list--motion_captures">
        <h2>Motion Captures</h2>
          <span>
            <input type="checkbox" id="check_all_motion_captures" name="check_all_motion_captures" value="no">
            check all Motion Captures
          </span>
          {% for entry in motion_captures %}
          {# @TODO change to span with managed layout #}
          <div>
            <input type="checkbox" class="motion_capture" name="{{ entry }}" value="no">
            {# <span>{{ entry }}</span> #}
            <a href="{{ url_for('recordings.download_motion_capture', filename=entry) }}">{{ entry }}</a>
          </div>
          {% endfor %}
      </div>
      <div class="recordings__list--recordings">
        <h2>Recordings</h2>
          <span>
            <input type="checkbox" id="check_all_recordings" name="check_all_recordings" value="no">
            check all Recordings
          </span>
          {% for entry in recordings %}
          {# @TODO change to span with managed layout #}
          <div>
            <input type="checkbox" class="recording" name="{{ entry }}" value="no">
            <a href="{{ url_for('recordings.download_recording', filename=entry) }}">{{ entry }}</a>
          </div>
          {% endfor %}
      </div>
    </div>
    
    <div class="recordings__buttons">
      <button class="recordings__buttons--download" type="submit" name="action" value="download_selected">Download selected</button>
      {% if g.user["is_admin"] == True %}
      <button class="recordings__buttons--delete" type="submit" name="action" value="delete_selected">[UNSAFE!] Delete selected</button>
      {% endif %}
    </div>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  function attachCheckAll(parentSelector, childSelector) {
    // every child selector is set to parent's value
    const parent = document.querySelector(parentSelector);
    const children = document.querySelectorAll(childSelector);

    // on parents change:
    parent.addEventListener("change", () => {
      // set all children's checkboxes to parent's value
      children.forEach((cb) => cb.checked = parent.checked);
    });
  }

  attachCheckAll("#check_all_motion_captures", ".motion_capture");
  attachCheckAll("#check_all_recordings", ".recording");


  function attachShiftSelect(selector) {
    // shift-select using event listener for checkboxes
    // click, shift+click set's the value to the whole range of boxes
    const checkboxes = document.querySelectorAll(selector)
    let lastIndex = 0; // implicitly selecting from the start

    checkboxes.forEach((cb, index) => {
      cb.addEventListener("click", (event) => {
        // shift+click: apply range
        if (event.shiftKey) {
          const first = Math.min(lastIndex, index);
          const last = Math.max(lastIndex, index);
          const value = cb.checked;

          for (let i = first; i <= last; i++) {
            checkboxes[i].checked = value;
          }
        }
        // always update anchor
        lastIndex = index;
      });
    });
  }
  
  attachShiftSelect(".motion_capture");
  attachShiftSelect(".recording");
});
</script>
{% endblock %}